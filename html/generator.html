<!DOCTYPE html>
<html>
<head>
	
	<script type="text/javascript" src="../ExcelPlus/sheetjs.all.min.js"></script>
	<script type="text/javascript" src="../ExcelPlus/excelplus-2.2.min.js"></script>

	<meta charset="utf-8">

	<link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
	<link rel="stylesheet" href="../css/main.css">
	<link rel="stylesheet" href="../css/print.css" type="text/css" media="print"> 
	<link rel="stylesheet" href="../css/drag-css.css" type="text/css" media="screen" />
	<meta name="viewport" content="width=device-width">

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>

	<!-- Drag and drop library. Credits to http://www.redips.net/javascript/drag-and-drop-table-content/ -->
	<script type="text/javascript"  src="../js/redips-drag-min.js"></script> 
	<script type="text/javascript" src="../js/header.js"></script>
</head>
<body onload="REDIPS.drag.init(); REDIPS.drag.dropMode = 'single';">
	
    <div class="nav">
      <div class="container">
        <ul class="pull-left">
          <li><a href="../html/index.html">Main</a></li>
          <li><a href="../html/signup.html">Sign Up or Log In</a></li>
		  <li><a href="../html/paddlers.html">Roster Editor</a></li>
        </ul>
      </div>
    </div>

    <div id="main">
	<!-- Title -->
	<h1>Lineup Generator</h1>
	
	<!--Prompt-->
	<div id="step1">
		<h3>1. Upload your .xlsx spreadsheet here.</h3>

		<!-- "Choose File" button -->
		<object id="file-object"></object>
	</div>


	

	<!-- Buttons for choosing the day that the lineup is for -->
	<div id="step2" style="display:none";>
		<h4>Info read from spreadsheet:</h4>
		<div id="result"></div>
		<br>

		<h3>2. Choose the day that you are making a lineup for.</h3>
		<button onclick="friday();">Friday</button>
		<button onclick="saturday();">Saturday</button>
		<button onclick="sunday();">Sunday</button>
	</div>
	


	<div id="step3" style="display:none">
		<div id="unknown"></div>	
		<br>		
	</div>	

	
	<button id = "fillButton" onclick="autofill()" style="display:none;">Autofill</button>
	<button id = "helpButton" onclick="getSuggestion()">Get suggestions</button>
	<button id = "tenButton" onclick="addTenMan()">Add 10Man</button>
	<button id = "twentyButton" onclick="addTwentyMan()">Add 20Man</button>
</div>






	<div id="redips-drag" style="width:100%; ">
		
		<!-- Roster table -->
		<div style="float:left;">
			<h2 id="rosterTitle">Roster from spreadsheet will load here.</h2>
			<table id="roster">
				<colgroup>
					<col width="100"/>
				</colgroup>

				<tbody id="rosterBody"></tbody>
			</table>
		</div>

		<!-- Div for boat tables -->
		<div id="boatDiv"></div>



		<!-- Full roster table -->
		<div style="float:left; padding-left:100px;">
			<h1>Full Roster</h1>
			<table id="fullRoster">
				<colgroup>
					<col width="100"/>
				</colgroup>

				<tbody id="fullRosterBody"></tbody>
			</table>
		</div>


	</div>

<!--Credits to http://aymkdn.github.io/ExcelPlus/ for the ExcelPlus library -->
<script>
	Parse.initialize("Ir9YzTyozWr3zBMzUq8MsOs9toJyWO1E33jGjFni", "NEpob0acvjC8kZo8y8LxX4QQsyPewCmZ4fOfjSY0");
	var currentuser = Parse.User.current();

	var fridayOutput = "Friday Paddlers:\n";
	var fridayArray = [];
	var saturdayOutput = "Saturday Paddlers:\n";
	var saturdayArray = [];
	var sundayOutput = "Sunday Paddlers:\n"
	var sundayArray = [];
	var leftArray = [[]];
	var rightArray = [[]];
	var Paddler = Parse.Object.extend("Paddler");
	var leftWeight = [];
	var rightWeight = [];
	var balanceWeight = [];
	var numBoats = 0;
	var tableCount = 0;

	if(currentuser){

		

		// Fills in the full roster;
		var fullQuery = new Parse.Query(Paddler);	
				fullQuery.equalTo("Owner", Parse.User.current().getUsername());
				fullQuery.find({
					success: function(results) {					
						for(var i = 0; i < results.length; i++){
							var table = document.getElementById("fullRosterBody");
							var row = table.insertRow(-1);
							var cell = row.insertCell(0).innerHTML = '<div id="'+ results[i].id + '"class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';
							
						}
						REDIPS.drag.init();
					},
					error: function(error) {
						alert("error");
					}
				});



		var ep = new ExcelPlus();
		ep.openLocal({
			"flashPath":"/ExcelPlus/sfwobject/",
			"labelButton":"Open an Excel file"
		},function() {
			// format of a = [row][column]
			var a = ep.selectSheet(1).readAll();
			


			var nameCol = 0;
			for (var row = 0; row < a.length; row++) {
				for(var col = 0; col < a[row].length; col++){
					if(a[row][col] == "Your name (including last initial):"){
						nameCol = col;
					}


					if(a[row][col] == "Will you be attending Friday's practice?"){
						
						var fridayRow = 1;
						
						for(var fridayRow = 1; fridayRow < a.length; fridayRow++){
							if(a[fridayRow][col] == "Yes!" || a[fridayRow][col] == "Yes, and I can drive."){
								fridayOutput += (a[fridayRow][nameCol] + ", ");
								fridayArray.push(a[fridayRow][nameCol]);
							}
						}

						// The slice removes the comma and space after the last name
						document.getElementById("result").innerHTML += fridayOutput.slice(0,fridayOutput.length-2) + "<br>";

					}
					else if(a[row][col] == "Will you be attending Saturday's practice?"){
						for(var saturdayRow = 1; saturdayRow < a.length; saturdayRow++){
							if(a[saturdayRow][col] == "Yes!" || a[saturdayRow][col] == "Yes, and I can drive."){
								saturdayOutput += (a[saturdayRow][nameCol] + ", ");
								saturdayArray.push(a[saturdayRow][nameCol]);
							}
						}

						// The slice removes the comma and space after the last name
						document.getElementById("result").innerHTML += saturdayOutput.slice(0,saturdayOutput.length-2) + "<br>";

					}
					else if(a[row][col] == "Will you be attending Sunday's practice?"){
						for(var sundayRow = 1; sundayRow < a.length; sundayRow++){
							if(a[sundayRow][col] == "Yes!" || a[sundayRow][col] == "Yes, and I can drive."){
								sundayOutput += (a[sundayRow][nameCol] + ", ");
								sundayArray.push(a[sundayRow][nameCol]);
							}
						}

						// The slice removes the comma and space after the last name
						document.getElementById("result").innerHTML += sundayOutput.slice(0,sundayOutput.length-2) + "<br>";

					}

				}
			}

			// Shows step 2 and hides step 1 material
			document.getElementById("step2").style.display = "block";
			document.getElementById("step1").style.display = "none";	
			document.getElementById("file-object").style.display = "none";
		});


	}


		// Friday roster filler
		function friday() {

			// Clears roster if day is switched
			document.getElementById("rosterBody").innerHTML = "";
			

			var query = new Parse.Query(Paddler);	
			
			// Copies friday array into tmp
			var tmp = [];
			for(var a = 0; a < fridayArray.length; a++){
				tmp[a] = fridayArray[a];
			}

			query.containedIn("Name", tmp);
			query.equalTo("Owner", Parse.User.current().getUsername());
			query.find({
				success: function(results) {
					document.getElementById("rosterTitle").innerHTML = "Friday Roster";
					for(var i = 0; i < results.length; i++){
						tmp.splice(tmp.indexOf(results[i].get("Name")), 1);

						var table = document.getElementById("rosterBody");
						var row = table.insertRow(-1);
						var cell = row.insertCell(0).innerHTML = '<div id="' + results[i].id + '"class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';
						
					}
					

					document.getElementById("unknown").innerHTML = "<br><p style='background-color:#FF6666'>Paddlers not found in team roster: " + tmp.toString() + "</p>";
					document.getElementById("step2").style.display = "none";
					document.getElementById("step3").style.display = "block";
					document.getElementById("fillButton").style.display = "block";
					REDIPS.drag.init();
				},
				error: function(error) {
					alert("error");
				}
			});

		}

				// Friday roster filler
		function saturday() {
			// Clears roster if day is switched
			document.getElementById("rosterBody").innerHTML = "";

			var query = new Parse.Query(Paddler);	
			
			// Copies friday array into tmp
			var tmp = [];
			for(var a = 0; a < saturdayArray.length; a++){
				tmp[a] = saturdayArray[a];
			}

			query.containedIn("Name", tmp);
			query.equalTo("Owner", Parse.User.current().getUsername());
			query.find({
				success: function(results) {
					document.getElementById("rosterTitle").innerHTML = "Saturday Roster";
					for(var i = 0; i < results.length; i++){
						tmp.splice(tmp.indexOf(results[i].get("Name")), 1);

						var table = document.getElementById("rosterBody");
						var row = table.insertRow(-1);
						var cell = row.insertCell(0).innerHTML = '<div id="' + results[i].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';
						
					}
					document.getElementById("unknown").innerHTML = "<br><p style='background-color:#FF6666'>Paddlers not found in team roster: " + tmp.toString() + "</p>";
					document.getElementById("step2").style.display = "none";
					document.getElementById("step3").style.display = "block";
					document.getElementById("fillButton").style.display = "block";
					REDIPS.drag.init();

					
				},
				error: function(error) {
					alert("error");
				}
			});
		}

				// Friday roster filler
		function sunday() {
			// Clears roster if day is switched
			document.getElementById("rosterBody").innerHTML = "";

			var query = new Parse.Query(Paddler);	
			
			// Copies friday array into tmp
			var tmp = [];
			for(var a = 0; a < sundayArray.length; a++){
				tmp[a] = sundayArray[a];
			}

			query.containedIn("Name", tmp);
			query.equalTo("Owner", Parse.User.current().getUsername());
			query.find({
				success: function(results) {
					document.getElementById("rosterTitle").innerHTML = "Sunday Roster";
					for(var i = 0; i < results.length; i++){
						tmp.splice(tmp.indexOf(results[i].get("Name")), 1);

						var table = document.getElementById("rosterBody");
						var row = table.insertRow(-1);
						var cell = row.insertCell(0).innerHTML = '<div id="' + results[i].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';
						
					}
					document.getElementById("unknown").innerHTML = "<br><p style='background-color:#FF6666'>Paddlers not found in team roster: " + tmp.toString() + "</p>";
					document.getElementById("step2").style.display = "none";
					document.getElementById("step3").style.display = "block";
					document.getElementById("fillButton").style.display = "block";
					REDIPS.drag.init();

					
				},
				error: function(error) {
					alert("error");
				}
			});
		}

	// Handles changes to people in the boat
	REDIPS.drag.event.dropped = function(target) {


		// Location of the target cell / source cell
		var position = REDIPS.drag.getPosition();
		var boatNumber = position[0] - 1;


		
		var weightQuery = new Parse.Query(Paddler);
		weightQuery.equalTo("Owner", Parse.User.current().getUsername());
		weightQuery.equalTo("objectId", REDIPS.drag.obj.getAttribute('id'));


		weightQuery.find({
			success: function(results) {

				var weight = results[0].get("Weight");

				// If dropped into boat
				if(position[0] > 0 && position[0] <= tableCount){		
					alert("Moved into a boat");
					// If person was dragged from a different table
					if(position[3] != position[0]){
						
						// Adds right or left weight depending on drop position
						if(position[2] == 0){
							leftArray[boatNumber][position[1]] = weight;
							leftWeight[boatNumber] += weight;
						}
						// Otherwise dropped into right side
						else{
							rightArray[boatNumber][position[1]] = weight;
							rightWeight[boatNumber] += weight;
						}
					}	
					// If person was dragged from a different column in the boat
					else if(position[2] != position[5]){

						if(position[2] == 0){
							leftArray[boatNumber][position[1]] = weight;
							rightArray[boatNumber][position[4]] = 0;
							leftWeight[boatNumber] += weight;
							rightWeight[boatNumber] -= weight;
						}
						
						else{
							rightArray[boatNumber][position[1]] = weight;
							leftArray[boatNumber][position[4]] = 0;
							rightWeight[boatNumber] += weight;
							leftWeight[boatNumber] -= weight; 
						}
					}
					else if(position[2] == position[5]){
						// Moved to same column
						if(position[2] == 0){
							leftArray[boatNumber][position[1]] = weight;
							leftArray[boatNumber][position[4]] = 0;
						}
						else{
							rightArray[boatNumber][position[1]] = weight;
							rightArray[boatNumber][position[4]] = 0;
						}

					}
				}
				else {
					// If source table was the boat
					if(position[3] == position[0]){
						// Remove weight of that person
						if(position[5] == 0){
							leftWeight[boatNumber] -= weight;
							leftArray[boatNumber][position[1]] = 0;
						}
						else{
							rightWeight[boatNumber] -= weight;
							rightArray[boatNumber][position[1]] = 0;
						}
					}
				}

				
				getBalance(boatNumber);

				alert("Second getbalance");
				//getBalance();
			},
			error: function(error) {

			}
		});


	}
		
	function getBalance(boatNumber){
		balanceWeight[boatNumber] = leftWeight[boatNumber] - rightWeight[boatNumber];
			if(balanceWeight[boatNumber] > 0){
				document.getElementById("balance" + boatNumber).innerHTML = "Weight is: " + (balanceWeight[boatNumber]) + " lbs left-heavy";
			}
			else if(balanceWeight[boatNumber] < 0){
				document.getElementById("balance" + boatNumber).innerHTML = "Weight is: " + (-balanceWeight[boatNumber]) + " lbs right-heavy";
			}
			else{
				document.getElementById("balance" + boatNumber).innerHTML = "Weight is: Balanced";	
			}
	}

	function getSuggestion(boatNumber){

		
		if(balanceWeight[boatNumber] == 0){
			alert("Cannot be more balanced.");
			return;
		}

		var boatRows = 10;
		var bTable = document.getElementById("boatBody" + boatNumber);
		var lNames = [];
		var rNames = [];

		for(var i = 0; i < boatRows; i++){
			// Fills nameArray with names of people in the boat
			if(bTable.rows[i].cells[0].innerText.slice(0, -1) != ""){
				lNames.push(bTable.rows[i].cells[0].innerText.slice(0, -1));
			}

			if(bTable.rows[i].cells[1].innerText.slice(0, -1) != ""){
				rNames.push(bTable.rows[i].cells[1].innerText.slice(0, -1));
			}
		}
			


		var lQuery = new Parse.Query(Paddler);
		lQuery.containedIn("Name", lNames);
		lQuery.equalTo("Owner", Parse.User.current().getUsername());
		lQuery.find({
			success:function(lResults){
				var rQuery = new Parse.Query(Paddler);
				rQuery.containedIn("Name", rNames);
				rQuery.equalTo("Owner", Parse.User.current().getUsername());
				rQuery.find({
					success:function(rResults){
						// lResults is the list of paddlers on the left side of the boat
						// rResults is the list of paddlers on the right side of the boat



						var lIndex1 = -1;
						var rIndex1 = -1;

						var closest = Math.abs(balanceWeight[boatNumber]);

						// This loop finds the paddlers that, when moved, will make the boat the most balanced
						for(var i = 0; i < lResults.length; i++){
							for(var j = 0; j < rResults.length; j++){
								//alert("Comparing " + lResults[i].get("Name") + " and " + rResults[j].get("Name"));
								if(Math.abs(balanceWeight[boatNumber] - ((lResults[i].get("Weight") - rResults[j].get("Weight")) * 2)) < closest){
									lIndex1 = i;
									rIndex1 = j;




									closest = Math.abs(balanceWeight[boatNumber] - ((lResults[i].get("Weight") - rResults[j].get("Weight")) * 2));
								}
							}
						}

						// Checks if moving someone to an open spot on the left side will be the best option
						if(lResults.length < boatRows){
							for(var i = 0; i < rResults.length; i++){
								if(Math.abs(balanceWeight[boatNumber] + (rResults[i].get("Weight") * 2)) < closest ){
									closest = Math.abs(balanceWeight[boatNumber] + (rResults[i].get("Weight") * 2));
									rIndex1 = i;
									lIndex1 = -1;
								}
							}
						}

						// Checks if moving someone to an open spot on the right side will be the best option
						if(rResults.length < boatRows){
							for(var i = 0; i < lResults.length; i++){
								if(Math.abs(balanceWeight[boatNumber] - (lResults[i].get("Weight") * 2)) < closest ){
									closest = Math.abs(balanceWeight[boatNumber] + (lResults[i].get("Weight") * 2));
									lIndex1 = i;
									rIndex1 = -1;
								}
							}
						}

						if(lIndex1 == -1 && rIndex1 != -1){
							alert("Switch " + rResults[rIndex1].get("Name") + " to the left side.");
						}
						else if(rIndex1 == -1 && lIndex1 != -1){
							alert("Switch " + lResults[lIndex1].get("Name") + " to the right side.");
						}
						else if(rIndex1 == -1 && lIndex1 == -1){
							alert("Cannot be more balanced.");
						}
						else{
							alert("Switch " + lResults[lIndex1].get("Name") + " and " + rResults[rIndex1].get("Name"));
						}
					},
					error: function(error){
						alert("Error");
					}
				});
			},
			error: function (error){
				alert("Error");
			}

		});

	}

	function autofill(boatNumber){
		var rTable = document.getElementById("rosterBody");
		var bTable = document.getElementById("boatBody" + boatNumber);
		var nameArray = [];

		for(var i = 0; i < rTable.rows.length; i++){
			// Slice removes a newline at the end of the name
			if(rTable.rows[i].cells[0].innerText.slice(0, -1) != ""){
				nameArray.push(rTable.rows[i].cells[0].innerText.slice(0, -1));
			}
		}

		
		var query = new Parse.Query(Paddler);

		query.containedIn("Name", nameArray);
		query.equalTo("Owner", Parse.User.current().getUsername());
		query.ascending("Weight");
		query.find({
			success: function (results){
				// results is the list of paddlers that were in the roster
				
				
				// Temporarily set to 10, may change this to allow for both 20man and 10man boats
				var boxRows = 3;
				var engineRows = 7;
				var rocketRows = 10;
				var boatRows = 10;
				// This loop finds box rows that have only one person 
				// sitting in them already and fills 
				// the empty spot with someone of similar weight
				for(var i = 0; i < boatRows; i++){
					// For each row, find out if anyone is already filled in. 
					// If so, check if they have a partner, and if not, find someone with the
					// closest weight, and put them there
					var row = bTable.rows[i].cells;



					// If left side is empty
					if(row[0].innerHTML == ""){
						// If right side is not empty
						if(row[1].innerHTML != ""){
							// Match weight of other person in row
							// The default weight difference is 30.
							var closest = 200;
							var index = -1;
							for(var j = 0; j < results.length; j++){
								if(Math.abs(rightArray[boatNumber][i] - results[j].get("Weight")) < closest){
									if(results[j].get("Side") == "Left"){
										closest = Math.abs(rightArray[boatNumber][i] - results[j].get("Weight"));
										index = j;
									}
								}
							}
							bTable.rows[i].cells[0].innerHTML = '<div id="' + results[index].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[index].get("Name") + '</div>';

							leftWeight[boatNumber] += results[index].get("Weight");
							leftArray[boatNumber][i] = results[index].get("Weight");
						
							results.splice(index, 1);
						
							getBalance(boatNumber);
						}
					}
					else{
						if(row[1].innerHTML == ""){
							var closest = 200;
							var index = -1;
							for(var j = 0; j < results.length; j++){
								if(Math.abs(leftArray[boatNumber][i] - results[j].get("Weight")) < closest){
									if(results[j].get("Side") == "Right"){
										closest = Math.abs(leftArray[boatNumber][i] - results[j].get("Weight"));
										index = j;
									}
								}
							}
							bTable.rows[i].cells[1].innerHTML = '<div id="' + results[index].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[index].get("Name") + '</div>';

							rightWeight[boatNumber] += results[index].get("Weight");
							rightArray[boatNumber][i] = results[index].get("Weight");
						
							results.splice(index, 1);
							// Match weight of other person in row
							getBalance(boatNumber);	
						}
					}
						
				}

				// Fills in the rest of the empty rows
				for(var j = 0; j < boatRows; j++){

					var row = bTable.rows[j].cells;
					
					// Checks that row is empty
					if(row[0].innerHTML == "" && row[1].innerHTML == ""){
						
						// Fills box rows with box paddlers if true
						if(j < boxRows){
							var boxL = [];
							var boxR = [];
							for(var k = 0; k < results.length; k++){
								if(results[k].get("Section") == "Box"){
									if(results[k].get("Side") == "Left"){
										boxL.push(results[k]);
									}
									else{
										boxR.push(results[k]);
									}
								
								}
							}

							var closest = 200;
							var indexL = -1;
							var indexR = -1;
							for(var k = 0; k < boxL.length; k++){
								for(var l = 0; l < boxR.length; l++){
									if(Math.abs(boxL[k].get("Weight") - boxR[l].get("Weight")) < closest){
										closest = Math.abs(boxL[k].get("Weight") - boxR[l].get("Weight"));
										indexL = k;
										indexR = l;
									}
								}
							}




							if(indexL != -1){
								row[0].innerHTML = '<div id="' + boxL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + boxL[indexL].get("Name") + '</div>';
							
								leftWeight[boatNumber] += boxL[indexL].get("Weight");
								leftArray[boatNumber][j] = boxL[indexL].get("Weight");
														


								for(var r = 0; r < results.length; r++){
									if(boxL[indexL].get("Name") == results[r].get("Name")){
										results.splice(r, 1);		
									}
								}
								
							}

							if(indexR != -1){
								row[1].innerHTML = '<div id="' + boxR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + boxR[indexR].get("Name") + '</div>';	

								rightWeight[boatNumber] += boxR[indexR].get("Weight");
								rightArray[boatNumber][j] = boxR[indexR].get("Weight");
								
								for(var r = 0; r < results.length; r++){
									if(boxR[indexR].get("Name") == results[r].get("Name")){
										results.splice(r, 1);	
									}
								}
							}
						}

						// Fills engine rows with engine paddlers if true
						else if(j < engineRows){
							var engineL = [];
							var engineR = [];
							for(var k = 0; k < results.length; k++){
								if(results[k].get("Section") == "Engine"){
									if(results[k].get("Side") == "Left"){
										engineL.push(results[k]);
									}
									else{
										engineR.push(results[k]);
									}
								
								}
							}

							var closest = 200;
							var indexL = -1;
							var indexR = -1;
							for(var k = 0; k < engineL.length; k++){
								for(var l = 0; l < engineR.length; l++){
									if(Math.abs(engineL[k].get("Weight") - engineR[l].get("Weight")) < closest){
										closest = Math.abs(engineL[k].get("Weight") - engineR[l].get("Weight"));
										indexL = k;
										indexR = l;
									}
								}
							}

							if(indexL != -1){
								row[0].innerHTML = '<div id="' + engineL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + engineL[indexL].get("Name") + '</div>';
							
								leftWeight[boatNumber] += engineL[indexL].get("Weight");
								leftArray[boatNumber][j] = engineL[indexL].get("Weight");
														


								for(var r = 0; r < results.length; r++){
									if(engineL[indexL].get("Name") == results[r].get("Name")){
										results.splice(r, 1);		
									}
								}
								
							}

							if(indexR != -1){
								row[1].innerHTML = '<div id="' + engineR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + engineR[indexR].get("Name") + '</div>';	

								rightWeight[boatNumber] += engineR[indexR].get("Weight");
								rightArray[boatNumber][j] = engineR[indexR].get("Weight");
								
								for(var r = 0; r < results.length; r++){
									if(engineR[indexR].get("Name") == results[r].get("Name")){
										results.splice(r, 1);		
									}
								}
							}
						}

						// Fills rocket rows with rocket paddlers if true
						else if(j < rocketRows){
							var rocketL = [];
							var rocketR = [];
							for(var k = 0; k < results.length; k++){
								if(results[k].get("Section") == "Rocket"){
									if(results[k].get("Side") == "Left"){
										rocketL.push(results[k]);
									}
									else{
										rocketR.push(results[k]);
									}
								
								}
							}

							var closest = 200;
							var indexL = -1;
							var indexR = -1;
							for(var k = 0; k < rocketL.length; k++){
								for(var l = 0; l < rocketR.length; l++){
									if(Math.abs(rocketL[k].get("Weight") - rocketR[l].get("Weight")) < closest){
										closest = Math.abs(rocketL[k].get("Weight") - rocketR[l].get("Weight"));
										indexL = k;
										indexR = l;
									}
								}
							}

							if(indexL != -1){
								row[0].innerHTML = '<div id="' + rocketL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + rocketL[indexL].get("Name") + '</div>';
							
								leftWeight[boatNumber] += rocketL[indexL].get("Weight");
								leftArray[boatNumber][j] = rocketL[indexL].get("Weight");
														


								for(var r = 0; r < results.length; r++){
									if(rocketL[indexL].get("Name") == results[r].get("Name")){
										results.splice(r, 1);		
									}
								}
								
							}

							if(indexR != -1){
								row[1].innerHTML = '<div id="' + rocketR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + rocketR[indexR].get("Name") + '</div>';	

								rightWeight[boatNumber] += rocketR[indexR].get("Weight");
								rightArray[boatNumber][j] = rocketR[indexR].get("Weight");
								
								for(var r = 0; r < results.length; r++){
									if(rocketR[indexR].get("Name") == results[r].get("Name")){
										results.splice(r, 1);		
									}
								}
							}
						}
					}
				}


				// Fills in any remaining rows with leftover paddlers
				for(var j = 0; j < boatRows; j++){
					var row = bTable.rows[j].cells;
					if(bTable.rows[j].cells[0].innerHTML == "" && bTable.rows[j].cells[1].innerHTML == ""){
						var emptyL = [];
						var emptyR = [];
						for(var k = 0; k < results.length; k++){
							if(results[k].get("Side") == "Left"){
								emptyL.push(results[k]);
							}
							else{
								emptyR.push(results[k]);
							}
						}

						var closest = 200;
						var indexL = -1;
						var indexR = -1;

						// flag: 0 = left side has no paddlers, 1 = right side has no paddlers, 2 = both sides have paddlers
						// 3 = left side has only one paddler, 4 = right side has only one paddler,  -1 = out of paddlers
						var flag = -1;
						if(emptyL.length == 0){
							
							if(emptyR.length == 0){
								//alert("Out of paddlers");
							}
							else if (emptyR.length == 1){
								flag = 4;
							}
							else{
								// left side has no paddlers
								for(var k = 0; k < emptyR.length; k++){
									for(var l = k+1; l < emptyR.length; l++){
										if(Math.abs(emptyR[k].get("Weight") - emptyR[l].get("Weight")) < closest){
											closest = Math.abs(emptyR[k].get("Weight") - emptyR[l].get("Weight"));
											indexL = k;
											indexR = l;
											flag = 0;
										}
									}
								}

								// handle having only one more paddler
							}	
						}
						else if(emptyR.length == 0){
							// Right side has no paddlers
							if(emptyL.length == 1){
								flag = 3;
							}
							else{
								for(var k = 0; k < emptyL.length; k++){
									for(var l = k+1; l < emptyL.length; l++){
										if(Math.abs(emptyL[k].get("Weight") - emptyL[l].get("Weight")) < closest){
											closest = Math.abs(emptyL[k].get("Weight") - emptyL[l].get("Weight"));
											indexL = k;
											indexR = l;
											flag = 1;
										}
									}
								}
							}
						}
						else{
							// both sides have paddlers available
							for(var k = 0; k < emptyL.length; k++){
								for(var l = 0; l < emptyR.length; l++){
									if(Math.abs(emptyL[k].get("Weight") - emptyR[l].get("Weight")) < closest){
										closest = Math.abs(emptyL[k].get("Weight") - emptyR[l].get("Weight"));
										indexL = k;
										indexR = l;
										flag = 2;
									}
								}
							}
						}

						if(flag == -1){
						//	alert("Out of paddlers to put into boat");
						}
						else if(flag == 0){
							row[0].innerHTML = '<div id="' + emptyR[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexL].get("Name") + '</div>';
							
							leftWeight[boatNumber] += emptyR[indexL].get("Weight");
							leftArray[boatNumber][j] = emptyR[indexL].get("Weight");
							
							row[1].innerHTML = '<div id="' + emptyR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexR].get("Name") + '</div>';
							
							rightWeight[boatNumber] += emptyR[indexR].get("Weight");
							rightArray[boatNumber][j] = emptyR[indexR].get("Weight");
					
							for(var r = 0; r < results.length; r++){
								if(emptyR[indexL].get("Name") == results[r].get("Name") || emptyR[indexR].get("Name") == results[r].get("Name")){
									results.splice(r, 1);		
								}
							}

						}
						else if(flag == 1){
							row[0].innerHTML = '<div id="' + emptyL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexL].get("Name") + '</div>';
							
							leftWeight[boatNumber] += emptyL[indexL].get("Weight");
							leftArray[boatNumber][j] = emptyL[indexL].get("Weight");
							
							row[1].innerHTML = '<div id="' + emptyL[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexR].get("Name") + '</div>';
							
							rightWeight[boatNumber] += emptyL[indexR].get("Weight");
							rightArray[boatNumber][j] = emptyL[indexR].get("Weight");
					
							for(var r = 0; r < results.length; r++){
								if(emptyL[indexL].get("Name") == results[r].get("Name") || emptyL[indexR].get("Name") == results[r].get("Name")){
									results.splice(r, 1);		
								}
							}

						}
						else if(flag == 2){


								row[0].innerHTML = '<div id="' + emptyL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexL].get("Name") + '</div>';
							
								leftWeight[boatNumber] += emptyL[indexL].get("Weight");
								leftArray[boatNumber][j] = emptyL[indexL].get("Weight");
														


								for(var r = 0; r < results.length; r++){
									if(emptyL[indexL].get("Name") == results[r].get("Name")){
										results.splice(r, 1);		
									}
								}
								
							

			
								row[1].innerHTML = '<div id="' + emptyR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexR].get("Name") + '</div>';	

								rightWeight[boatNumber] += emptyR[indexR].get("Weight");
								rightArray[boatNumber][j] = emptyR[indexR].get("Weight");
								
								for(var r = 0; r < results.length; r++){
									if(emptyR[indexR].get("Name") == results[r].get("Name")){
										results.splice(r, 1);	
									}
								}
							
						}
						else if (flag == 3){
							row[0].innerHTML = '<div id="' + emptyL[0].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[0].get("Name") + '</div>';
							
							leftWeight[boatNumber] += emptyL[0].get("Weight");
							leftArray[boatNumber][j] = emptyL[0].get("Weight");

							for(var r = 0; r < results.length; r++){
								if(emptyL[0].get("Name") == results[r].get("Name")){
									results.splice(r, 1);	
								}
							}

						}
						else if (flag == 4){

							row[1].innerHTML = '<div id="' + emptyR[0].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[0].get("Name") + '</div>';
							
							rightWeight[boatNumber] += emptyR[0].get("Weight");
							rightArray[boatNumber][j] = emptyR[0].get("Weight");

							for(var r = 0; r < results.length; r++){
								if(emptyR[0].get("Name") == results[r].get("Name")){
									results.splice(r, 1);	
								}
							}

						}
					}
				}

				names = [];
				for(var s = 0; s < results.length; s++){
					names.push(results[s].get("Name"));
				}
				if(names.length == 0){
					for(var r = 0; r < rTable.rows.length; r++){
						rTable.rows[r].cells[0].innerHTML = "";
					}
				}
				else{
				// Removes people from roster if they were put in the boat
					for(var s = 0; s < names.length; s++){
						for(var r = 0; r < rTable.rows.length; r++){
							if(names.indexOf(rTable.rows[r].cells[0].innerText.slice(0,-1)) == -1){
								rTable.rows[r].cells[0].innerHTML = "";
							}
						}
					}
				}



				getBalance(boatNumber);
				REDIPS.drag.init();
			},
			error: function (error){
				alert("Error");
			}

		});
	}

	function clearBoat(boatNumber){
		var boatRows = 10;
		var bTable = document.getElementById("boatBody" + boatNumber);
		var fTable = document.getElementById("fullRosterBody");
		// For each row
		//	for each column
		//    if FULL roster contains name in cell, add cell to daily roster
		//    else clear cell

		var fullRosterNames = [];

		for(var i = 0; i < fTable.rows.length; i++){
			fullRosterNames.push(fTable.rows[i].cells[0].innerText);
		}

		for(var i = 0; i < boatRows; i++){
			for(var j = 0; j < 2; j++){
				if(bTable.rows[i].cells[j].innerText == ""){
					//Found empty cell, continue to next slot in boat
					continue;
				}

				if(fullRosterNames.indexOf(bTable.rows[i].cells[j].innerText) != -1) {
					// Returning person to daily roster
					var rTable = document.getElementById("rosterBody");
					for(var k = 0; k < rTable.rows.length; k++){
						if(rTable.rows[k].cells[0].innerText == ""){
							rTable.rows[k].cells[0].innerHTML = bTable.rows[i].cells[j].innerHTML;
							bTable.rows[i].cells[j].innerHTML = "";
						}
					}
					
				}
				else{
					// Returning person to full roster
					fTable.rows[fullRosterNames.indexOf("")].cells[0].innerHTML = bTable.rows[i].cells[j].innerHTML;
					fullRosterNames[fullRosterNames.indexOf("")] = bTable.rows[i].cells[j].innerText;
					bTable.rows[i].cells[j].innerHTML = "";
				}
			}
		}

		leftWeight[boatNumber] = 0;
		leftArray[boatNumber] = [0,0,0,0,0,0,0,0,0,0];
		rightWeight[boatNumber] = 0;
		leftArray[boatNumber] = [0,0,0,0,0,0,0,0,0,0];
		document.getElementById("balance" + boatNumber).innerHTML = "Weight is: Balanced";	
		balanceWeight[boatNumber] = 0;
		REDIPS.drag.init();


	}

	function addTwentyMan(){
		
		document.getElementById("boatDiv").innerHTML += 
			'<div style="float:left; padding-left:100px;">'
			+'	<h1>Boat ' + numBoats + '</h1>'
			+'	<table id="boat' + numBoats + '">'
			+'		<colgroup>'
			+'			<col width="100"/>'
			+'			<col width="100"/>'
			+'			</colgroup>'
			+'		<tbody id="boatBody' + numBoats + '">'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'			<tr>'
			+'				<td></td>'
			+'				<td></td>'
			+'			</tr>'
			+'		</tbody>'
			+'	</table>'
			+'	<button id = "clear' + numBoats + '" onclick="clearBoat(' + numBoats + ')">Clear</button>'
			+'	<button id = "help' + numBoats + '" onclick="getSuggestion(' + numBoats + ')">Get suggestions</button>'
			+'  <button id = "fill' + numBoats + '" onclick="autofill(' + numBoats + ')">Autofill</button>'
			+'  <div id = "balance' + numBoats + '"></div>'
			+'</div>';
			

			leftWeight[numBoats] = 0;
			rightWeight[numBoats] = 0;
			leftArray[numBoats] = [0,0,0,0,0,0,0,0,0,0];
			rightArray[numBoats] = [0,0,0,0,0,0,0,0,0,0];
			numBoats++;
			tableCount++;
			REDIPS.drag.init();
	}

	function addTenMan(){

	}

	
</script>



</body>

</html>