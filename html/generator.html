<!DOCTYPE html>
<html>
<head>
	
	<script type="text/javascript" src="../ExcelPlus/sheetjs.all.min.js"></script>
	<script type="text/javascript" src="../ExcelPlus/excelplus-2.2.min.js"></script>

	<meta charset="utf-8">

	<link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
	<link rel="stylesheet" href="../css/main.css">
	<link rel="stylesheet" href="../css/print.css" type="text/css" media="print"> 
	<link rel="stylesheet" href="../css/drag-css.css" type="text/css" media="screen" />
	<meta name="viewport" content="width=device-width">

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>

	<!-- Drag and drop library. Credits to http://www.redips.net/javascript/drag-and-drop-table-content/ -->
	<script type="text/javascript"  src="../js/redips-drag-min.js"></script> 
	<script type="text/javascript" src="../js/header.js"></script>

	<!-- Function library -->
	<script type="text/javascript" src="../js/functions.js"></script>
</head>
<body onload="REDIPS.drag.init(); REDIPS.drag.dropMode = 'single';">
	
    <div class="nav">
      <div class="container">
        <ul class="pull-left">
          <li><a href="../html/index.html">Main</a></li>
          <li><a href="../html/signup.html">Sign Up or Log In</a></li>
		  <li><a href="../html/paddlers.html">Roster Editor</a></li>
        </ul>
      </div>
    </div>

    <div id="main">
	<!-- Title -->
	<h1>Lineup Generator</h1>
	
	<!--Prompt-->
	<div id="step1">
		<h3>1. Upload your .xlsx spreadsheet here.</h3>

		<!-- "Choose File" button -->
		<object id="file-object"></object>
	</div>


	

	<!-- Buttons for choosing the day that the lineup is for -->
	<div id="step2" style="display:none";>
		<h4>Info read from spreadsheet:</h4>
		<div id="result"></div>
		<br>

		<h3>2. Choose the day that you are making a lineup for.</h3>
		<button onclick="friday(REDIPS.drag);">Friday</button>
		<button onclick="saturday(REDIPS.drag);">Saturday</button>
		<button onclick="sunday(REDIPS.drag);">Sunday</button>
	</div>
	


	<div id="step3" style="display:none">
		<div id="unknown"></div>	
		<br>		
	</div>	

	

	<button id = "tenButton" onclick="addTenMan()">Add 10Man</button>
	<button id = "twentyButton" onclick="addTwentyMan()">Add 20Man</button>
	<br>
	<select id = "loadChoice"></select>
	<button id = "loadButton" onclick="loadBoat(document.getElementById('loadChoice').value, numBoats)">Load Boat</button>
	<br>
	<button id = "generateButton" onclick="generate()">Generate Lineup</button>
	
</div>






	<div id="redips-drag" style="width:100%; ">
		
		<!-- Roster table -->
		<div style="float:left;">
			<h2 id="rosterTitle">Roster from spreadsheet will load here.</h2>
			<table id="roster">
				<colgroup>
					<col width="100"/>
				</colgroup>

				<tbody id="rosterBody"></tbody>
			</table>
		</div>

		<!-- Div for boat tables -->
		<div id="boatDiv"></div>



		<!-- Full roster table -->
		<div style="float:left; padding-left:100px;">
			<h1>Full Roster</h1>
			<table id="fullRoster">
				<colgroup>
					<col width="100"/>
				</colgroup>

				<tbody id="fullRosterBody"></tbody>
			</table>
		</div>


	</div>

<!--Credits to http://aymkdn.github.io/ExcelPlus/ for the ExcelPlus library -->
<script>
	Parse.initialize("Ir9YzTyozWr3zBMzUq8MsOs9toJyWO1E33jGjFni", "NEpob0acvjC8kZo8y8LxX4QQsyPewCmZ4fOfjSY0");
	var currentuser = Parse.User.current();
	var Paddler = Parse.Object.extend("Paddler");

	// Arrays of names of people going to practice each day
	var fridayArray = [];
	var saturdayArray = [];
	var sundayArray = [];

	// Text used to show which people are going to each day
	var fridayOutput = "Friday Paddlers:\n";
	var saturdayOutput = "Saturday Paddlers:\n";
	var sundayOutput = "Sunday Paddlers:\n"
	
	// For each boat, there is an array that contains the weights of each individual person on each side
	var leftArray = [[]];
	var rightArray = [[]];
	
	
	// Arrays of the total weights of the left and right sides of each boat
	var leftWeight = [];
	var rightWeight = [];
	
	// An array of the weight differences of each boat
	var balanceWeight = [];
	
	// Number of boats added
	var numBoats = 0;

	// Number of redips tables, including boats, full roster, and daily roster
	var tableCount = 1;
	
	// Keeps track of the number of 20 and 10 man boats
	var num10 = 0;
	var num20 = 0;

	// 0 = 10 man, 1 = 20 man
	var boatArray = [];

	// Constants that define which columns in all tables refer to the left and right rows
	var left = 0;
	var right = 1;

	if(currentuser){
		// Fills in the full roster;
		var fullQuery = new Parse.Query(Paddler);	
		fullQuery.equalTo("Owner", Parse.User.current().getUsername());
		fullQuery.ascending("Name");
		fullQuery.find({
			success: function(results) {
			var leftCount = 0;
			var rightCount = 0;					
				for(var i = 0; i < results.length; i++){
					var table = document.getElementById("fullRosterBody");
					
					// Builds the roster table with both left and right sides
					if(results[i].get("Side") == "Left"){
						if(leftCount == table.rows.length){
							table.insertRow(-1);
							var cell = table.rows[leftCount].insertCell(left).innerHTML = '<div id="' + results[i].id + '"class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';
						}
						else{
							var cell = table.rows[leftCount].cells[left].innerHTML = '<div id="' + results[i].id + '"class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';	
						}
						
						leftCount++;
					}
					else{
						if(rightCount == table.rows.length){
							table.insertRow(-1);

							// Inserts an extra placeholder cell on the left side so that we can have a right side cell
							table.rows[rightCount].insertCell(left);
							
							var cell = table.rows[rightCount].insertCell(right).innerHTML = '<div id="' + results[i].id + '"class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';	
						}
						else{
							var cell = table.rows[rightCount].insertCell(right).innerHTML = '<div id="' + results[i].id + '"class="redips-drag" style="border-style: solid; cursor: move;">' + results[i].get("Name") + '</div>';		
						}					
						rightCount++;
					}
					
				}
				REDIPS.drag.init();
			},
			error: function(error) {
				alert("error");
			}
		});

		var Boat = Parse.Object.extend("Boat");
		var boatQuery = new Parse.Query(Boat);	
		
		boatQuery.equalTo("Owner", Parse.User.current().getUsername());
		boatQuery.find({
			success: function(results){
				for(var i = 0; i < results.length; i++){
					document.getElementById("loadChoice").innerHTML += "<option value='" + results[i].get('Name') + "'>" + results[i].get('Name') + "</option>"
				}
			},
			error: function(error){
				alert("Error");
			}
		});

		var ep = new ExcelPlus();
		ep.openLocal({
			"flashPath":"/ExcelPlus/sfwobject/",
			"labelButton":"Open an Excel file"
		},function() {
			// format of a = [row][column]
			var a = ep.selectSheet(1).readAll();
			var nameCol = -1;
			
			var youFound = false;
			var friFound = false;
			var satFound = false;
			var sunFound = false;

			for (var row = 0; row < a.length; row++) {
				for(var col = 0; col < a[row].length; col++){
					if(a[row][col].toLowerCase().indexOf("you") > -1){
						nameCol = col;
					}
					if(nameCol != -1){
						break;
					}
				}
				if(nameCol != -1){
					break;
				}
			}


			for (var row = 0; row < a.length; row++) {
				for(var col = 0; col < a[row].length; col++){
					if(a[row][col] == null){
						continue;
					}

					if(a[row][col].toLowerCase().indexOf("friday") > -1 && !friFound){
						friFound = true;
						var fridayRow = 1;
						while(a[fridayRow]){
							if(a[fridayRow][col]){
								if(a[fridayRow][col].toLowerCase().indexOf("yes") > -1){
									fridayOutput += (a[fridayRow][nameCol] + ", ");
									fridayArray.push(a[fridayRow][nameCol]);
								}
							}
							fridayRow++;
						}
						// The slice removes the comma and space after the last name
						document.getElementById("result").innerHTML += fridayOutput.slice(0,fridayOutput.length-2) + "<br>";

					}
					else if(a[row][col].toLowerCase().indexOf("saturday") > -1 && !satFound){
						satFound = true;
						var saturdayRow = 1;
						while(a[saturdayRow]){
							if(a[saturdayRow][col]){
								if(a[saturdayRow][col].toLowerCase().indexOf("yes") > -1){
									saturdayOutput += (a[saturdayRow][nameCol] + ", ");
									saturdayArray.push(a[saturdayRow][nameCol]);
								}
							}
							saturdayRow++;
						}
						// The slice removes the comma and space after the last name
						document.getElementById("result").innerHTML += saturdayOutput.slice(0,saturdayOutput.length-2) + "<br>";

					}
					else if(a[row][col].toLowerCase().indexOf("sunday") > -1 && !sunFound){
						sunFound = true;
						var sundayRow = 1;
						while(a[sundayRow]){
							if(a[sundayRow][col]){
								if(a[sundayRow][col].toLowerCase().indexOf("yes") > -1){
									sundayOutput += (a[sundayRow][nameCol] + ", ");
									sundayArray.push(a[sundayRow][nameCol]);
								}
							}
							sundayRow++;
						}
						// The slice removes the comma and space after the last name
						document.getElementById("result").innerHTML += sundayOutput.slice(0,sundayOutput.length-2) + "<br>";

					}

				}
			}
			// Shows step 2 and hides step 1 material
			document.getElementById("step2").style.display = "block";
			document.getElementById("step1").style.display = "none";	
			document.getElementById("file-object").style.display = "none";
			REDIPS.drag.init();
		});


	}


		

	// Handles changes to people in the boat
	REDIPS.drag.event.dropped = function(target) {
		// Drop from daily roster to boat
		// Drop from full roster to boat
		// Drop from boat to boat
		// Drop from daily roster to full roster (don't allow)
		// Drop from full roster to daily roster (don't allow)
		// Drop from boat to full roster (check if name is already in there, if so, don't allow)
		// Drop from boat to daily roster (check if name is already in there, if so, don't allow)

	 	// pos[0] - target table index
	    // pos[1] - target row index
	    // pos[2] - target cell (column) index
	    // pos[3] - source table index
	    // pos[4] - source row index
	    // pos[5] - source cell (column) index
		// Location of the target cell / source cell
		var position = REDIPS.drag.getPosition();
		var boatNumber = position[0] - 1;


		
		var weightQuery = new Parse.Query(Paddler);
		weightQuery.equalTo("Owner", Parse.User.current().getUsername());
		weightQuery.equalTo("objectId", REDIPS.drag.obj.getAttribute('id'));


		weightQuery.find({
			success: function(results) {
				// Results[0] is the dragged / dropped paddler
				var weight = results[0].get("Weight");
				if(position[0] == 0){
					// Dropped into daily roster
					dailyDrop(results[0], weight, position, rightArray, rightWeight, leftArray, leftWeight);
					return;
				}
				else if(position[0] == tableCount){
					// Dropped into full roster
					fullDrop(results[0], weight, position, rightArray, rightWeight, leftArray, leftWeight);
					return;
				}
				else{
					if(position[0] == position[3]){
						// Dropped into the same boat
						sameBoatDrop(results[0], weight, position, rightArray, rightWeight, leftArray, leftWeight);
					}
					else{
						if(position[3] == tableCount || position[3] == 0){
							// From full roster or daily roster to boat

							// Adds right or left weight depending on drop position
							if(position[2] == left){
								leftArray[boatNumber][position[1]] = weight;
								leftWeight[boatNumber] += weight;
								if(results[0].get("Side") == "Right"){
									document.getElementById("boatBody" + boatNumber).rows[position[1]].cells[position[2]].style.backgroundColor = "red";
								}
							}
							// Otherwise dropped into right side
							else{
								rightArray[boatNumber][position[1]] = weight;
								rightWeight[boatNumber] += weight;
								if(results[0].get("Side") == "Left"){
									document.getElementById("boatBody" + boatNumber).rows[position[1]].cells[position[2]].style.backgroundColor = "red";
								}
							}


							// Resets color of source cell
							if(position[3] == 0){
								// Source cell was in daily roster
								document.getElementById("rosterBody").rows[position[4]].cells[position[5]].style.backgroundColor = "#eee";
							}
							else if(position[3] == tableCount){
								// Source cell was in full roster
								document.getElementById("fullRosterBody").rows[position[4]].cells[position[5]].style.backgroundColor = "#eee";
							}

							getBalance(boatNumber);
							return;
						}
						else{
							boatToBoat(results[0], weight, position, rightArray, rightWeight, leftArray, leftWeight);
						}
					}
				}
			},
			error: function(error) {
				alert("Error");
			}
		});
	}
		
	

	function getSuggestion(boatNumber){

		
		if(balanceWeight[boatNumber] == 0){
			alert("Cannot be more balanced.");
			return;
		}

		
		var boatRows = leftArray[boatNumber].length;
		var bTable = document.getElementById("boatBody" + boatNumber);
		var lNames = [];
		var rNames = [];

		for(var i = 0; i < boatRows; i++){
			// Fills arrays with names of people in the boat
			if(bTable.rows[i].cells[left].innerText.slice(0, -1) != ""){
				lNames.push(bTable.rows[i].cells[left].innerText.slice(0, -1));
			}

			if(bTable.rows[i].cells[right].innerText.slice(0, -1) != ""){
				rNames.push(bTable.rows[i].cells[right].innerText.slice(0, -1));
			}
		}
		
		var dNames = [];
		var dTable = document.getElementById("rosterBody");
		for(var i = 0; i < dTable.rows.length; i++){
			if(dTable.rows[i].cells[left] && dTable.rows[i].cells[left].innerText != ""){
				dNames.push(dTable.rows[i].cells[left].innerText.slice(0, -1));
			}

			if(dTable.rows[i].cells[right] && dTable.rows[i].cells[right].innerText != ""){
				dNames.push(dTable.rows[i].cells[right].innerText.slice(0, -1));	
			}
		}

		var dQuery = new Parse.Query(Paddler);
		dQuery.containedIn("Name", dNames);
		dQuery.equalTo("Owner", Parse.User.current().getUsername());
		dQuery.find({
			success: function(dResults){
				// dResults is the list of people in the daily roster

				var lQuery = new Parse.Query(Paddler);
				lQuery.containedIn("Name", lNames);
				lQuery.equalTo("Owner", Parse.User.current().getUsername());
				lQuery.find({
					success:function(lResults){
						var rQuery = new Parse.Query(Paddler);
						rQuery.containedIn("Name", rNames);
						rQuery.equalTo("Owner", Parse.User.current().getUsername());
						rQuery.find({
							success:function(rResults){
								// lResults is the list of paddlers on the left side of the boat
								// rResults is the list of paddlers on the right side of the boat
								
								var spareLeft = [];
								var spareRight = [];

								for(var i = 0; i < dResults.length; i++){
									if(dResults[i].get("Side") == "Left"){
										spareLeft.push(dResults[i]);
									}								
									else{
										spareRight.push(dResults[i]);
									}
								}

								
								var lIndex1 = -1;
								var rIndex1 = -1;
								var closest = Math.abs(balanceWeight[boatNumber]);
								var subLeft = false;
								var subRight = false;
								var dIndex = -1;

								var closestSub = closest;
								// left heavy = balanceweight is positive
								for(var i = 0; i < lResults.length; i++){
									for(var j = 0; j < spareLeft.length; j++){
										if(Math.abs(balanceWeight[boatNumber] - (lResults[i].get("Weight") - spareLeft[j].get("Weight"))) < closestSub){
											dIndex = dResults.indexOf(spareLeft[j]);
											if(dIndex == -1){
												alert(spareLeft[j].get("Name"));
											}
											subLeft = true;
											closestSub = Math.abs(balanceWeight[boatNumber] - (lResults[i].get("Weight") - spareLeft[j].get("Weight")));
											lIndex = i;
										}
									}
								}

								// right heavy = balanceweight is negative
								// need to find a spareRight that is less than the rResult
								for(var i = 0; i < rResults.length; i++){
									for(var j = 0; j < spareRight.length; j++){
										if(Math.abs(balanceWeight[boatNumber] + (rResults[i].get("Weight") - spareRight[j].get("Weight"))) < closestSub){
											dIndex = dResults.indexOf(spareRight[j]);
											subRight = true;

											// Reset this to false in case this sub is better
											subLeft = false;

											closestSub = Math.abs(balanceWeight[boatNumber] + (rResults[i].get("Weight") - spareRight[j].get("Weight")));
											rIndex = i;
										}
									}
								}

								if(!subRight && !subLeft){
									// No subs available
									// This loop finds the paddlers that, when switched to the other side, will make the boat the most balanced
									for(var i = 0; i < lResults.length; i++){
										for(var j = 0; j < rResults.length; j++){
											if(Math.abs(balanceWeight[boatNumber] - ((lResults[i].get("Weight") - rResults[j].get("Weight")) * 2)) < closest){
												lIndex1 = i;
												rIndex1 = j;

												closest = Math.abs(balanceWeight[boatNumber] - ((lResults[i].get("Weight") - rResults[j].get("Weight")) * 2));
											}
										}
									}

									// Checks if moving someone to an open spot on the left side will be the best option
									if(lResults.length < boatRows){
										for(var i = 0; i < rResults.length; i++){
											if(Math.abs(balanceWeight[boatNumber] + (rResults[i].get("Weight") * 2)) < closest ){
												closest = Math.abs(balanceWeight[boatNumber] + (rResults[i].get("Weight") * 2));
												rIndex1 = i;
												lIndex1 = -1;
											}
										}
									}

									// Checks if moving someone to an open spot on the right side will be the best option
									if(rResults.length < boatRows){
										for(var i = 0; i < lResults.length; i++){
											if(Math.abs(balanceWeight[boatNumber] - (lResults[i].get("Weight") * 2)) < closest ){
												closest = Math.abs(balanceWeight[boatNumber] + (lResults[i].get("Weight") * 2));
												lIndex1 = i;
												rIndex1 = -1;
											}
										}
									}

									if(lIndex1 == -1 && rIndex1 != -1){
										alert("Switch " + rResults[rIndex1].get("Name") + " to the left side.");
									}
									else if(rIndex1 == -1 && lIndex1 != -1){
										alert("Switch " + lResults[lIndex1].get("Name") + " to the right side.");
									}
									else if(rIndex1 == -1 && lIndex1 == -1){
										alert("Cannot be more balanced.");
									}
									else{
										alert("Switch " + lResults[lIndex1].get("Name") + " and " + rResults[rIndex1].get("Name"));
									}
								}
								else{
									// A sub is available
									if(subRight){
										alert("Best sub is " + dResults[dIndex].get("Name") + " for " + rResults[rIndex].get("Name"));
									}
									else if (subLeft) {
										alert("Best sub is " + dResults[dIndex].get("Name") + " for " + lResults[lIndex].get("Name"));	
									}
								}
							},
							error: function(error){
								alert("Error");
							}
						});
					},
					error: function (error){
						alert("Error");
					}

				});
			},
			error: function(error){

			}
		});


	}

	// Using only the daily roster, determines a good number of boats and fills them
	function generate(){
		var nameArray = getDailyNames();

		// If there is only one boat, just use autofill
		if(numBoats == 1){
			var query = new Parse.Query(Paddler);
			query.equalTo("Owner", Parse.User.current().getUsername());
			query.containedIn("Name", nameArray);		
			query.find().then(
				function (results){
					autofill2(0);
				},
				function(error){
					alert("Error");
				}
			);	

			return;
		}


		// Calculate how to spread people throughout the boats evenly

		var numPeople = nameArray.length;
		var numGroups = num10 + (2*num20);
		var peoplePerGroup = parseInt(numPeople / numGroups);
		var blues = [];
		var whites = [];

		var query = new Parse.Query(Paddler);
		query.equalTo("Owner", Parse.User.current().getUsername());
		query.containedIn("Name", nameArray);
		query.ascending("Weight");
		query.find().then(
			function(results){
				// This adds the white and blue boat paddlers to their respective arrays
				for(var i = 0; i < results.length; i++){
					if(results[i].get("Boat") == "Blue"){
						blues.push(results[i]);
					}
					else{
						whites.push(results[i]);
					}
				}
				return results;
		}).then(
			function(results){
				//if white boat found {}
				//else{



				// groups contains numGroups sets of peoplePerGroup people 
				var groups = [];


				// Total weights of both sides
				var lTotal = 0;
				var rTotal = 0;
				var lefties = [];
				var righties = [];
				for(var i = 0; i < results.length; i++){
					if(results[i].get("Side") == "Left"){
						lTotal += results[i].get("Weight");
						lefties.push(results[i]);
					}
					else{
						rTotal += results[i].get("Weight");
						righties.push(results[i]);
					}
				}

				// goal is the ideal weight balance after all weight has been distributed
				var goal = (rTotal - lTotal) / numGroups;
				alert("Goal is " + goal);

	/*			var groupStart = 0;
				// Before assembling all of the boats, checks if there are an uneven number of people and assigns them to boat 0
				if(lefties.length > righties.length){
					groups.push([]);
					while(lefties.length > righties.length){
						groups[0].push(lefties[0]);
						groups[0].push(lefties[1]);
						groups[0].push(righties[righties.length - 1]);
						alert("Added "  + lefties[0].get("Name") + " " + lefties[1].get("Name") + righties[righties.length-1].get("Name"));
						lefties.splice(0, 2);
						righties.splice(righties.length - 1, 1);
					}
					groupStart = 1;
				}
				else if(lefties.length < righties.length){
					groups.push([]);
					while(lefties.length < righties.length){
						groups[0].push(righties[0]);
						groups[0].push(righties[1]);
						groups[0].push(lefties[lefties.length - 1]);
						alert("Added "  + righties[0].get("Name") + " " + righties[1].get("Name") + lefties[lefties.length-1].get("Name"));
						righties.splice(0, 2);
						lefties.splice(lefties.length - 1, 1);
					}
					groupStart = 1;
				}
*/
				for(var i = 0; i < numGroups; i++){
					// Adds a boat with a left and right array
					groups.push([ [],[] ]);
					alert("Making group " + i);
					
					// Determines whether to start taking paddlers from the left side or the right side in case of uneven numbers
					// 0 = left, 1 = right
					var start = 0;
					if(lefties.length < righties.length){
						start = 1;
					}


					
					// Negative = left heavy, positive = right heavy
					var gWeight = 0;

//					alert("Starting at " + start);
//Sort by weight, alternate from front and back
					for(var j = 0; j < peoplePerGroup; j++){
						if(start == 0){
							if(gWeight <= goal){
				//				alert("Adding " + lefties[0].get("Name"));
								groups[i][0].push(lefties[0]);
								gWeight -= lefties[0].get("Weight");
								lefties.splice(0, 1);
	//							alert("Done adding left");
							}
							else{
				//				alert("Adding " + lefties[lefties.length - 1].get("Name"));
								groups[i][0].push(lefties[lefties.length - 1]);
								gWeight -= lefties[lefties.length - 1].get("Weight");
								lefties.splice(lefties.length - 1, 1);
//								alert("Done adding left");
							}

							if(righties.length > 0){
								start = 1;
							}
//							alert("Done adding from left");
						}
						else{
							if(gWeight >= goal){
				//				alert("Adding " + righties[0].get("Name"));
								groups[i][1].push(righties[0]);
								gWeight += righties[0].get("Weight");
								righties.splice(0, 1);
//								alert("Done adding right");
							}
							else{
				//				alert("Adding " + righties[righties.length - 1].get("Name"));
								groups[i][1].push(righties[righties.length - 1]);
								gWeight += righties[righties.length - 1].get("Weight");
								righties.splice(righties.length - 1, 1);
	//							alert("Done adding right");
							}


							if(lefties.length > 0){
								start = 0;
							}
//							alert("Done adding from right");
						}
					}
				}

				while(lefties.length > 0){
					groups[0][0].push(lefties[0]);
					lefties.splice(0, 1);
		//			alert("adding " + lefties[i] + " to boat 0");
				}
				
				while(righties.length > 0){
					groups[0][1].push(righties[0]);
					righties.splice(0, 1);
		//			alert("adding " + righties[i] + " to boat 0");
				}

				var canBalance = true;
				while(canBalance){
					canBalance = false;
					// Finds the weight balance of each boat
					var groupWeight = [];
					for(var i = 0; i < groups.length; i++){
						groupWeight.push([]);
						for(var j = 0; j < groups[i][0].length; j++){
							groupWeight[i] -= groups[i][0][j].get("Weight");
						}

						for(var j = 0; j < groups[i][1].length; j++){
							groupWeight[i] += groups[i][1][j].get("Weight");
						}
						

						alert("weight for group " + i + " is " + groupWeight[i]);
					}


					// Finds which boats are the farthest away from each other in terms of balance
					var rightIndex = -1;
					var leftIndex = -1;
					var rightVal = 0;
					var leftVal = 0;

					for(var i = 0; i < groups.length; i++){
						if(Math.abs(groupWeight[i] - goal) == 0){
							alert("Group " + i + " has the goal weight balance");
						}

						if(groupWeight[i] - goal > rightVal){
							rightVal = groupWeight[i] - goal;
							rightIndex = i;
						}
						
						if(groupWeight[i] - goal < leftVal){
							leftVal = groupWeight[i] - goal;
							leftIndex = i;
						}
					}

					// left / rightIndex are the indices of the least balanced boats compared to goal

					
					var closestToGoal;
					if(Math.abs(groupWeight[leftIndex] - goal) < Math.abs(groupWeight[rightIndex] - goal)){
						closestToGoal = groupWeight[leftIndex];
					}
					else{
						closestToGoal = groupWeight[rightIndex];
					}

					alert("Closest to goal is " + closestToGoal);

					// Indexes of the best paddlers to switch
					var bestLeft = -1;
					var bestRight = -1;
					var bestWeight = Math.abs(goal - closestToGoal);

					// 0 = left, 1 = right
					var whichSide = -1;
					// Find the best people to switch
					if(rightIndex != -1 && leftIndex != -1){
						// We know that at least two boats could possibly benefit from a switch
						alert("Looking for same-side paddlers from different boats whose weight difference is closest to " + Math.abs(goal - closestToGoal));
						// Compares all left paddlers from both boats
						for(var i = 0; i < groups[leftIndex][0].length; i++){
							for(var j = 0; j < groups[rightIndex][0].length; j++){
								alert("Comparing " +  groups[leftIndex][0][i].get("Name") + " and " + groups[rightIndex][0][j].get("Name") + " whose difference is " + Math.abs((groups[leftIndex][0][i].get("Weight") - groups[rightIndex][0][j].get("Weight"))));
								


								if(Math.abs((groups[leftIndex][0][i].get("Weight") - groups[rightIndex][0][j].get("Weight")) - Math.abs(goal - closestToGoal)) < bestWeight){
									bestWeight = Math.abs(Math.abs((groups[leftIndex][0][i].get("Weight") - groups[rightIndex][0][j].get("Weight"))) - Math.abs(goal - closestToGoal));
									bestLeft = i;
									bestRight = j;
									alert("Found match left");
									canBalance = true;
									whichSide = 0;
								}
							}
						}

						// Compares all right paddlers from both boats
						for(var i = 0; i < groups[leftIndex][1].length; i++){
							for(var j = 0; j < groups[rightIndex][1].length; j++){
								alert("Comparing " +  groups[leftIndex][1][i].get("Name") + " and " + groups[rightIndex][1][j].get("Name") + " whose difference is " + Math.abs((groups[leftIndex][1][i].get("Weight") - groups[rightIndex][1][j].get("Weight"))));
								


								if(Math.abs((groups[leftIndex][1][i].get("Weight") - groups[rightIndex][1][j].get("Weight")) - Math.abs(goal - closestToGoal)) < bestWeight){
									bestWeight = Math.abs(Math.abs((groups[leftIndex][1][i].get("Weight") - groups[rightIndex][1][j].get("Weight"))) - Math.abs(goal - closestToGoal));
									bestLeft = i;
									bestRight = j;
									alert("Found match right");
									canBalance = true;
									whichSide = 1;
								}
							}
						}

						if(canBalance){
							if(whichSide == 0){
								alert("Should switch " + groups[leftIndex][0][bestLeft].get("Name") + " and " + groups[rightIndex][0][bestRight].get("Name") + " whose difference is " + Math.abs((groups[leftIndex][0][bestLeft].get("Weight") - groups[rightIndex][0][bestRight].get("Weight"))));

								//Switches them
								alert("Before switch: 1. " + groups[leftIndex][0][bestLeft].get("Name") + ", 2. " + groups[rightIndex][0][bestRight].get("Name"));
								var tmp = groups[leftIndex][0][bestLeft];
								groups[leftIndex][0][bestLeft] = groups[rightIndex][0][bestRight];
								groups[rightIndex][0][bestRight] = tmp;
								alert("After switch: 1. " + groups[leftIndex][0][bestLeft].get("Name") + ", 2. " + groups[rightIndex][0][bestRight].get("Name"));
							}
							else if(whichSide == 1){
								alert("Should switch " + groups[leftIndex][1][bestLeft].get("Name") + " and " + groups[rightIndex][1][bestRight].get("Name") + " whose difference is " + Math.abs((groups[leftIndex][1][bestLeft].get("Weight") - groups[rightIndex][1][bestRight].get("Weight"))));

								//Switches them
								alert("Before switch: 1. " + groups[leftIndex][1][bestLeft].get("Name") + ", 2. " + groups[rightIndex][1][bestRight].get("Name"));
								var tmp = groups[leftIndex][1][bestLeft];
								groups[leftIndex][1][bestLeft] = groups[rightIndex][1][bestRight];
								groups[rightIndex][1][bestRight] = tmp;
								alert("After switch: 1. " + groups[leftIndex][1][bestLeft].get("Name") + ", 2. " + groups[rightIndex][1][bestRight].get("Name"));
							}
						}
					}
				}

				alert("Done balancing");
				var groupWeight = [];

				for(var i = 0; i < groups.length; i++){
					groupWeight.push([]);
					for(var j = 0; j < groups[i][0].length; j++){
						groupWeight[i] -= groups[i][0][j].get("Weight");
					}

					for(var j = 0; j < groups[i][1].length; j++){
						groupWeight[i] += groups[i][1][j].get("Weight");
					}
					

					alert("weight for group " + i + " is " + groupWeight[i]);
				}


				// Determine how to place this groups into 10 or 20 man boats
				// Probably put most balanced groups into 10 mans
				var finalBoats = [];
				for(var i = 0; i < boatArray.length; i++){
					finalBoats.push([]);

					if(boatArray[i] == 1){
						var best1 = -1;
						var best2 = -1;
						var difference = 200;
						// Found twenty man, find two groups whose average weights are closest to the goal
						for(var j = 0; j < groupWeight.length; j++){
							for(var k = j + 1; k < groupWeight.length; k++){
								if(Math.abs(((groupWeight[j] + groupWeight[k]) / 2) - goal) < difference){
									best1 = j;
									best2 = k;
									difference = Math.abs(((groupWeight[j] + groupWeight[k]) / 2) - goal);
								}
							}
						}


						alert("Fill twenty man " + i + " with groups of weights" + groupWeight[best1] + " and " + groupWeight[best2] + " whose average weight is " + difference);
						groupWeight.splice(best2, 1);
						groupWeight.splice(best1, 1);
						finalBoats[i] = [groups[best1], groups[best2]];
						groups.splice(best2, 1);
						groups.splice(best1, 1);						
					}
					else if(boatArray[i] == 0){
						// Found ten man, find group whose weight is closest to the goal
						var best = -1;
						var difference = 200;

						for(var j = 0; j < groupWeight.length; j++){
							if(Math.abs(groupWeight[j] - goal) < difference){
								best = j;
								difference = Math.abs(groupWeight.length - goal);
							} 
						}

						alert("Fill ten man " + i + " with group of weight " + groupWeight[best]);
						groupWeight.splice(best, 1);
						finalBoats[i] = [groups[best]];
						groups.splice(best, 1);
					}
				}
				alert("Final boats arranged");

				for(var i = 0; i < finalBoats.length; i++){
					var output = "Members of boat " + i + ": ";

					// Each element is a boat
					for(var j = 0; j < finalBoats[i].length; j++){
						// Each element is a group
						for(var k = 0; k < finalBoats[i][j].length; k++){
							// Each element is a side
							for(var l = 0; l < finalBoats[i][j][k].length; l++){
								// Each element is a paddler object
								output += finalBoats[i][j][k][l].get("Name") + ", " ;
							}
						}
					}
					alert(output);
				}
			}
		);





		// Count boats, find size of boats, determine number of people to put in ten man and twenties
	// Things to consider: White / blue, number of people, number of boats, size of boats
		// option 2: make all boats even with white / blue distribution

		// If number of boats > 1
			// find all white boat people
				// put them in the same boat
					// Case: more than 20 white boaters, go for best balance
					// Case: less than 20 white boaters, put them all in
						// Fill in spots aiming for best balance


		// Find out how many people go into each boat
		

	}


	function autofill(boatNumber, results){
		var rTable = document.getElementById("rosterBody");
		var bTable = document.getElementById("boatBody" + boatNumber);
		var nameArray = getDailyNames();
		

		// results is the list of paddlers that were in the roster
		
	

		var boatRows = bTable.rows.length;
		var boxRows;
		var engineRows;
		var rocketRows;
		
		if(boatRows == 10){
			boxRows = 3;
			engineRows = 7;
			rocketRows = 10;
		}
		else {
			boxRows = 2;
			engineRows = 3;
			rocketRows = 5;
		}
		// This loop finds rows that have only one person 
		// sitting in them already and fills 
		// the empty spot with someone of similar weight
		for(var i = 0; i < boatRows; i++){
			// For each row, find out if anyone is already filled in. 
			// If so, check if they have a partner, and if not, find someone with the
			// closest weight, and put them there
			var row = bTable.rows[i].cells;

			// If left side is empty
			if(row[left].innerHTML == ""){
				// If right side is not empty
				if(row[right].innerHTML != ""){
					// Match weight of other person in row
					// The default weight difference is 30.
					var closest = 200;
					var index = -1;
					for(var j = 0; j < results.length; j++){
						if(Math.abs(rightArray[boatNumber][i] - results[j].get("Weight")) < closest){
							if(results[j].get("Side") == "Left"){
								closest = Math.abs(rightArray[boatNumber][i] - results[j].get("Weight"));
								index = j;
							}
						}
					}
					bTable.rows[i].cells[left].innerHTML = '<div id="' + results[index].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[index].get("Name") + '</div>';

					leftWeight[boatNumber] += results[index].get("Weight");
					leftArray[boatNumber][i] = results[index].get("Weight");
				
					results.splice(index, 1);
				
					getBalance(boatNumber);
				}
			}
			else{
				if(row[1].innerHTML == ""){
					var closest = 200;
					var index = -1;
					for(var j = 0; j < results.length; j++){
						if(Math.abs(leftArray[boatNumber][i] - results[j].get("Weight")) < closest){
							if(results[j].get("Side") == "Right"){
								closest = Math.abs(leftArray[boatNumber][i] - results[j].get("Weight"));
								index = j;
							}
						}
					}
					bTable.rows[i].cells[right].innerHTML = '<div id="' + results[index].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[index].get("Name") + '</div>';

					rightWeight[boatNumber] += results[index].get("Weight");
					rightArray[boatNumber][i] = results[index].get("Weight");
				
					results.splice(index, 1);
					// Match weight of other person in row
					getBalance(boatNumber);	
				}
			}

		}

		// Fills in the rest of the empty rows
		for(var j = 0; j < boatRows; j++){

			var row = bTable.rows[j].cells;
			
			// Checks that row is empty
			if(row[left].innerHTML == "" && row[right].innerHTML == ""){
				
				// Fills box rows with box paddlers if true
				if(j < boxRows){
					//alert(j);
					fillSection("Box", results, j, leftArray, leftWeight, rightArray, rightWeight, boatNumber);
				}

				// Fills engine rows with engine paddlers if true
				else if(j < engineRows){
					fillSection("Engine", results, j, leftArray, leftWeight, rightArray, rightWeight, boatNumber);
				}

				// Fills rocket rows with rocket paddlers if true
				else if(j < rocketRows){
					fillSection("Rocket", results, j, leftArray, leftWeight, rightArray, rightWeight, boatNumber);
				}
			}
		}

/*
		// Fills in any remaining rows with leftover paddlers
		for(var j = 0; j < boatRows; j++){
			var row = bTable.rows[j].cells;
			if(bTable.rows[j].cells[left].innerHTML == "" && bTable.rows[j].cells[right].innerHTML == ""){
				var emptyL = [];
				var emptyR = [];
				for(var k = 0; k < results.length; k++){
					if(results[k].get("Side") == "Left"){
						emptyL.push(results[k]);
					}
					else{
						emptyR.push(results[k]);
					}
				}

				var closest = 200;
				var indexL = -1;
				var indexR = -1;

				// flag: 0 = left side has no paddlers, 1 = right side has no paddlers, 2 = both sides have paddlers
				// 3 = left side has only one paddler, 4 = right side has only one paddler,  -1 = out of paddlers
				var flag = -1;
				if(emptyL.length == 0){
					
					if(emptyR.length == 0){
						//alert("Out of paddlers");
					}
					else if (emptyR.length == 1){
						flag = 4;
					}
					else{
						// left side has no paddlers
						for(var k = 0; k < emptyR.length; k++){
							for(var l = k+1; l < emptyR.length; l++){
								if(Math.abs(emptyR[k].get("Weight") - emptyR[l].get("Weight")) < closest){
									closest = Math.abs(emptyR[k].get("Weight") - emptyR[l].get("Weight"));
									indexL = k;
									indexR = l;
									flag = 0;
								}
							}
						}

						// handle having only one more paddler
					}	
				}
				else if(emptyR.length == 0){
					// Right side has no paddlers
					if(emptyL.length == 1){
						flag = 3;
					}
					else{
						for(var k = 0; k < emptyL.length; k++){
							for(var l = k+1; l < emptyL.length; l++){
								if(Math.abs(emptyL[k].get("Weight") - emptyL[l].get("Weight")) < closest){
									closest = Math.abs(emptyL[k].get("Weight") - emptyL[l].get("Weight"));
									indexL = k;
									indexR = l;
									flag = 1;
								}
							}
						}
					}
				}
				else{
					// both sides have paddlers available
					for(var k = 0; k < emptyL.length; k++){
						for(var l = 0; l < emptyR.length; l++){
							if(Math.abs(emptyL[k].get("Weight") - emptyR[l].get("Weight")) < closest){
								closest = Math.abs(emptyL[k].get("Weight") - emptyR[l].get("Weight"));
								indexL = k;
								indexR = l;
								flag = 2;
							}
						}
					}
				}

				if(flag == -1){
				//	alert("Out of paddlers to put into boat");
				}
				else if(flag == 0){
					row[left].innerHTML = '<div id="' + emptyR[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexL].get("Name") + '</div>';
					
					leftWeight[boatNumber] += emptyR[indexL].get("Weight");
					leftArray[boatNumber][j] = emptyR[indexL].get("Weight");
					
					row[right].innerHTML = '<div id="' + emptyR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexR].get("Name") + '</div>';
					
					rightWeight[boatNumber] += emptyR[indexR].get("Weight");
					rightArray[boatNumber][j] = emptyR[indexR].get("Weight");
			
					for(var r = 0; r < results.length; r++){
						if(emptyR[indexL].get("Name") == results[r].get("Name") || emptyR[indexR].get("Name") == results[r].get("Name")){
							results.splice(r, 1);		
							r--;
						}
					}

				}
				else if(flag == 1){
					row[left].innerHTML = '<div id="' + emptyL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexL].get("Name") + '</div>';
					
					leftWeight[boatNumber] += emptyL[indexL].get("Weight");
					leftArray[boatNumber][j] = emptyL[indexL].get("Weight");
					
					row[right].innerHTML = '<div id="' + emptyL[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexR].get("Name") + '</div>';
					
					rightWeight[boatNumber] += emptyL[indexR].get("Weight");
					rightArray[boatNumber][j] = emptyL[indexR].get("Weight");
			
					for(var r = 0; r < results.length; r++){
						if(emptyL[indexL].get("Name") == results[r].get("Name") || emptyL[indexR].get("Name") == results[r].get("Name")){
							results.splice(r, 1);		
							r--;
						}
					}

				}
				else if(flag == 2){
					row[left].innerHTML = '<div id="' + emptyL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexL].get("Name") + '</div>';
				
					leftWeight[boatNumber] += emptyL[indexL].get("Weight");
					leftArray[boatNumber][j] = emptyL[indexL].get("Weight");
											


					for(var r = 0; r < results.length; r++){
						if(emptyL[indexL].get("Name") == results[r].get("Name")){
							results.splice(r, 1);		
						}
					}
					
				


					row[right].innerHTML = '<div id="' + emptyR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexR].get("Name") + '</div>';	

					rightWeight[boatNumber] += emptyR[indexR].get("Weight");
					rightArray[boatNumber][j] = emptyR[indexR].get("Weight");
					
					for(var r = 0; r < results.length; r++){
						if(emptyR[indexR].get("Name") == results[r].get("Name")){
							results.splice(r, 1);	
						}
					}
					
				}
				else if (flag == 3){
					row[left].innerHTML = '<div id="' + emptyL[0].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[0].get("Name") + '</div>';
					
					leftWeight[boatNumber] += emptyL[0].get("Weight");
					leftArray[boatNumber][j] = emptyL[0].get("Weight");

					for(var r = 0; r < results.length; r++){
						if(emptyL[0].get("Name") == results[r].get("Name")){
							results.splice(r, 1);	
						}
					}

				}
				else if (flag == 4){
					row[right].innerHTML = '<div id="' + emptyR[0].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[0].get("Name") + '</div>';
					
					rightWeight[boatNumber] += emptyR[0].get("Weight");
					rightArray[boatNumber][j] = emptyR[0].get("Weight");

					for(var r = 0; r < results.length; r++){
						if(emptyR[0].get("Name") == results[r].get("Name")){
							results.splice(r, 1);	
						}
					}

				}
			}
		}
*/
		var names = getBoatNames(boatNumber);

		if(names.length == 0){
			for(var r = 0; r < rTable.rows.length; r++){
				if(rTable.rows[r].cells[left]){
					rTable.rows[r].cells[left].innerHTML = "";
				}
				if(rTable.rows[r].cells[right]){
					rTable.rows[r].cells[right].innerHTML = "";
				}
			}
		}
		else{
		// Removes people from roster if they were put in the boat
			for(var s = 0; s < names.length; s++){
				alert("Looking for " + names[s]);
				for(var r = 0; r < rTable.rows.length; r++){
					if(rTable.rows[r].cells[left]){
						if(names.indexOf(rTable.rows[r].cells[left].innerText.slice(0,-1)) != -1){
							rTable.rows[r].cells[left].innerHTML = "";
						}
					}
					if(rTable.rows[r].cells[right]){
						if(names.indexOf(rTable.rows[r].cells[right].innerText.slice(0,-1)) != -1){
							rTable.rows[r].cells[right].innerHTML = "";
						}
					}
				}
			}
		}


		getBalance(boatNumber);
		REDIPS.drag.init();
		

	}

function autofill2(boatNumber){
		var rTable = document.getElementById("rosterBody");
		var bTable = document.getElementById("boatBody" + boatNumber);
		var nameArray = getDailyNames();

		
		var query = new Parse.Query(Paddler);

		query.containedIn("Name", nameArray);
		query.equalTo("Owner", Parse.User.current().getUsername());
		query.ascending("Weight");
		query.find().then( 
			function (results){
				// results is the list of paddlers that were in the roster
				
			
	
				var boatRows = bTable.rows.length;
				var boxRows;
				var engineRows;
				var rocketRows;
				
				if(boatRows == 10){
					boxRows = 3;
					engineRows = 7;
					rocketRows = 10;
				}
				else {
					boxRows = 2;
					engineRows = 3;
					rocketRows = 5;
				}
				// This loop finds box rows that have only one person 
				// sitting in them already and fills 
				// the empty spot with someone of similar weight
				for(var i = 0; i < boatRows; i++){
					// For each row, find out if anyone is already filled in. 
					// If so, check if they have a partner, and if not, find someone with the
					// closest weight, and put them there
					var row = bTable.rows[i].cells;

					// If left side is empty
					if(row[left].innerHTML == ""){
						// If right side is not empty
						if(row[right].innerHTML != ""){
							// Match weight of other person in row
							// The default weight difference is 30.
							var closest = 200;
							var index = -1;
							for(var j = 0; j < results.length; j++){
								if(Math.abs(rightArray[boatNumber][i] - results[j].get("Weight")) < closest){
									if(results[j].get("Side") == "Left"){
										closest = Math.abs(rightArray[boatNumber][i] - results[j].get("Weight"));
										index = j;
									}
								}
							}
							bTable.rows[i].cells[left].innerHTML = '<div id="' + results[index].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[index].get("Name") + '</div>';

							leftWeight[boatNumber] += results[index].get("Weight");
							leftArray[boatNumber][i] = results[index].get("Weight");
						
							results.splice(index, 1);
						
							getBalance(boatNumber);
						}
					}
					else{
						if(row[1].innerHTML == ""){
							var closest = 200;
							var index = -1;
							for(var j = 0; j < results.length; j++){
								if(Math.abs(leftArray[boatNumber][i] - results[j].get("Weight")) < closest){
									if(results[j].get("Side") == "Right"){
										closest = Math.abs(leftArray[boatNumber][i] - results[j].get("Weight"));
										index = j;
									}
								}
							}
							bTable.rows[i].cells[right].innerHTML = '<div id="' + results[index].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + results[index].get("Name") + '</div>';

							rightWeight[boatNumber] += results[index].get("Weight");
							rightArray[boatNumber][i] = results[index].get("Weight");
						
							results.splice(index, 1);
							// Match weight of other person in row
							getBalance(boatNumber);	
						}
					}

				}

				// Fills in the rest of the empty rows
				for(var j = 0; j < boatRows; j++){

					var row = bTable.rows[j].cells;
					
					// Checks that row is empty
					if(row[left].innerHTML == "" && row[right].innerHTML == ""){
						
						// Fills box rows with box paddlers if true
						if(j < boxRows){
							//alert(j);
							fillSection("Box", results, j, leftArray, leftWeight, rightArray, rightWeight, boatNumber);
						}

						// Fills engine rows with engine paddlers if true
						else if(j < engineRows){
							fillSection("Engine", results, j, leftArray, leftWeight, rightArray, rightWeight, boatNumber);
						}

						// Fills rocket rows with rocket paddlers if true
						else if(j < rocketRows){
							fillSection("Rocket", results, j, leftArray, leftWeight, rightArray, rightWeight, boatNumber);
						}
					}
				}


				// Fills in any remaining rows with leftover paddlers
				for(var j = 0; j < boatRows; j++){

					var row = bTable.rows[j].cells;
					if(bTable.rows[j].cells[left].innerHTML == "" && bTable.rows[j].cells[right].innerHTML == ""){
						var emptyL = [];
						var emptyR = [];
						for(var k = 0; k < results.length; k++){
							if(results[k].get("Side") == "Left"){
								emptyL.push(results[k]);
							}
							else{
								emptyR.push(results[k]);
							}
						}

						var closest = 200;
						var indexL = -1;
						var indexR = -1;

						// flag: 0 = left side has no paddlers, 1 = right side has no paddlers, 2 = both sides have paddlers
						// 3 = left side has only one paddler, 4 = right side has only one paddler,  -1 = out of paddlers
						var flag = -1;
						if(emptyL.length == 0){
							
							if(emptyR.length == 0){
								//alert("Out of paddlers");
							}
							else if (emptyR.length == 1){
								flag = 4;
							}
							else{
								// left side has no paddlers
								for(var k = 0; k < emptyR.length; k++){
									for(var l = k+1; l < emptyR.length; l++){
										if(Math.abs(emptyR[k].get("Weight") - emptyR[l].get("Weight")) < closest){
											closest = Math.abs(emptyR[k].get("Weight") - emptyR[l].get("Weight"));
											indexL = k;
											indexR = l;
											flag = 0;
										}
									}
								}

								// handle having only one more paddler
							}	
						}
						else if(emptyR.length == 0){
							// Right side has no paddlers
							if(emptyL.length == 1){
								flag = 3;
							}
							else{
								for(var k = 0; k < emptyL.length; k++){
									for(var l = k+1; l < emptyL.length; l++){
										if(Math.abs(emptyL[k].get("Weight") - emptyL[l].get("Weight")) < closest){
											closest = Math.abs(emptyL[k].get("Weight") - emptyL[l].get("Weight"));
											indexL = k;
											indexR = l;
											flag = 1;
										}
									}
								}
							}
						}
						else{
							// both sides have paddlers available
							for(var k = 0; k < emptyL.length; k++){
								for(var l = 0; l < emptyR.length; l++){
									if(Math.abs(emptyL[k].get("Weight") - emptyR[l].get("Weight")) < closest){
										closest = Math.abs(emptyL[k].get("Weight") - emptyR[l].get("Weight"));
										indexL = k;
										indexR = l;
										flag = 2;
									}
								}
							}
						}

						if(flag == -1){
						//	alert("Out of paddlers to put into boat");
						}
						else if(flag == 0){
							alert("0");
							row[left].innerHTML = '<div id="' + emptyR[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexL].get("Name") + '</div>';
							row[left].style.backgroundColor = "red";
							leftWeight[boatNumber] += emptyR[indexL].get("Weight");
							leftArray[boatNumber][j] = emptyR[indexL].get("Weight");
							
							row[right].innerHTML = '<div id="' + emptyR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexR].get("Name") + '</div>';
							
							rightWeight[boatNumber] += emptyR[indexR].get("Weight");
							rightArray[boatNumber][j] = emptyR[indexR].get("Weight");
					
							for(var r = 0; r < results.length; r++){
								if(emptyR[indexL].get("Name") == results[r].get("Name") || emptyR[indexR].get("Name") == results[r].get("Name")){
									results.splice(r, 1);		
									r--;
								}
							}

						}
						else if(flag == 1){
							alert("1");
							row[left].innerHTML = '<div id="' + emptyL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexL].get("Name") + '</div>';
							
							leftWeight[boatNumber] += emptyL[indexL].get("Weight");
							leftArray[boatNumber][j] = emptyL[indexL].get("Weight");
							
							row[right].innerHTML = '<div id="' + emptyL[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexR].get("Name") + '</div>';
							row[right].style.backgroundColor = "red";

							rightWeight[boatNumber] += emptyL[indexR].get("Weight");
							rightArray[boatNumber][j] = emptyL[indexR].get("Weight");
					
							for(var r = 0; r < results.length; r++){
								if(emptyL[indexL].get("Name") == results[r].get("Name") || emptyL[indexR].get("Name") == results[r].get("Name")){
									results.splice(r, 1);	
									r--;	
								}
							}

						}
						else if(flag == 2){
alert("2");

								row[left].innerHTML = '<div id="' + emptyL[indexL].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[indexL].get("Name") + '</div>';
							
								leftWeight[boatNumber] += emptyL[indexL].get("Weight");
								leftArray[boatNumber][j] = emptyL[indexL].get("Weight");
														


								for(var r = 0; r < results.length; r++){
									if(emptyL[indexL].get("Name") == results[r].get("Name")){
										results.splice(r, 1);		
									}
								}
								
							

			
								row[right].innerHTML = '<div id="' + emptyR[indexR].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[indexR].get("Name") + '</div>';	

								rightWeight[boatNumber] += emptyR[indexR].get("Weight");
								rightArray[boatNumber][j] = emptyR[indexR].get("Weight");
								
								for(var r = 0; r < results.length; r++){
									if(emptyR[indexR].get("Name") == results[r].get("Name")){
										results.splice(r, 1);	
									}
								}
							
						}
						else if (flag == 3){
							alert("3");
							row[left].innerHTML = '<div id="' + emptyL[0].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyL[0].get("Name") + '</div>';
							
							leftWeight[boatNumber] += emptyL[0].get("Weight");
							leftArray[boatNumber][j] = emptyL[0].get("Weight");

							for(var r = 0; r < results.length; r++){
								if(emptyL[0].get("Name") == results[r].get("Name")){
									results.splice(r, 1);	
								}
							}

						}
						else if (flag == 4){
alert("4");
							row[right].innerHTML = '<div id="' + emptyR[0].id + '" class="redips-drag" style="border-style: solid; cursor: move;">' + emptyR[0].get("Name") + '</div>';
							
							rightWeight[boatNumber] += emptyR[0].get("Weight");
							rightArray[boatNumber][j] = emptyR[0].get("Weight");

							for(var r = 0; r < results.length; r++){
								if(emptyR[0].get("Name") == results[r].get("Name")){
									results.splice(r, 1);	
								}
							}

						}
					}
				}

				names = [];
				for(var s = 0; s < results.length; s++){
					names.push(results[s].get("Name"));
				}

				if(names.length == 0){
					for(var r = 0; r < rTable.rows.length; r++){
						if(rTable.rows[r].cells[left]){
							rTable.rows[r].cells[left].innerHTML = "";
						}
						if(rTable.rows[r].cells[right]){
							rTable.rows[r].cells[right].innerHTML = "";
						}
					}
				}
				else{
				// Removes people from roster if they were put in the boat
					for(var s = 0; s < names.length; s++){
						for(var r = 0; r < rTable.rows.length; r++){
							if(rTable.rows[r].cells[left]){
								if(names.indexOf(rTable.rows[r].cells[left].innerText.slice(0,-1)) == -1){
									rTable.rows[r].cells[left].innerHTML = "";
								}
							}
							if(rTable.rows[r].cells[right]){
								if(names.indexOf(rTable.rows[r].cells[right].innerText.slice(0,-1)) == -1){
									rTable.rows[r].cells[right].innerHTML = "";
								}
							}
						}
					}
				}


				getBalance(boatNumber);
				REDIPS.drag.init();
				
			},
			function (error){
				alert("Error");
			}
		);
	}	


	
</script>
</body>
</html>