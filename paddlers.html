<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <link rel="stylesheet" href="main.css">  

  <title>Roster Editor</title>
  <meta name="description" content="My Parse App">
  <meta name="viewport" content="width=device-width">

  <script type="text/javascript" src="sorting_functions.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>
</head>

<body>
  
  <div id="main">

		<h1>Roster Editor</h1>
		<h3>Edit your roster. Once you're finished here, press the build button to view a graphical representation.</h3>
		<div id="info">
			<table id="paddlers" style="width:50%">
				<tr>
					<th>Name</th>
					<th>Weight</th>
					<th>Side</th>
					<th>Section</th>
				</tr>
			</table>
		</div>
		
  </div>

  

  <script type="text/javascript">
	Parse.initialize("Ir9YzTyozWr3zBMzUq8MsOs9toJyWO1E33jGjFni", "NEpob0acvjC8kZo8y8LxX4QQsyPewCmZ4fOfjSY0");

		var Paddler = Parse.Object.extend("Paddler");
		var query = new Parse.Query(Paddler);
		query.find({
			success: function(results) {
				var myTable = document.getElementById("paddlers");
				
				// Adds paddlers to the table 
				for (var i = 0; i < results.length; i++) {
					var row = myTable.insertRow(-1);
					
					
					var object = results[i];
					
					var cell1 = row.insertCell(0);
					var cell2 = row.insertCell(1);
					var cell3 = row.insertCell(2);
					var cell4 = row.insertCell(3);
					var cell5 = row.insertCell(4);
					
					cell1.innerHTML = object.get('Name');	
					cell1.id = object.id;	
					cell2.innerHTML = object.get('Weight');
					cell3.innerHTML = object.get('Side');
					cell4.innerHTML = object.get('Section');

					// Delete button
					cell5.innerHTML = "<button id='" + object.id + "' onclick='editPaddler(this.id);'>Edit</button>  <button id='" + object.id + "' onclick='deletePaddler(this.id);'>Delete</button>";
					
				}
				
				
				// Creates a row for adding paddlers
				var row = myTable.insertRow(-1);
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);
				var cell5 = row.insertCell(4);
		
				// Fills the new row with values
				cell1.innerHTML = "<input type='text' id='nameEntry' placeholder='Name'>";
				cell2.innerHTML = "<input type='text' id='weightEntry' placeholder='Weight'>";
				cell3.innerHTML = "<select id='sideEntry'><option value='Any'>Any</option><option value='Left'>Left</option><option value='Right'>Right</option></select>";
				cell4.innerHTML = "<select id='sectionEntry'><option value='Any'>Any</option><option value='Box'>Box</option><option value='Engine'>Engine</option><option value='Rocket'>Rocket</option></select>";
				cell5.innerHTML = "<button onclick='addPaddler()'>Add</button>";
			},
			error: function(error){
				alert("Error");
			}
		});
		
		// Function from http://stackoverflow.com/questions/3885817/how-to-check-that-a-number-is-float-or-integer
		function isInt(value) {
			var er = /^-?[0-9]+$/;
			return er.test(value);
		}
		
		// Handles adding a paddler to the roster
		function addPaddler(){
		
			if(!isInt(document.getElementById("weightEntry").value)){
				alert("Enter an integer for the weight field!");
				return;
			}
			
			var Paddler = Parse.Object.extend("Paddler");
			var paddler = new Paddler();
			
			paddler.set("Name", document.getElementById("nameEntry").value);
			paddler.set("Weight", parseInt(document.getElementById("weightEntry").value));
			paddler.set("Side", document.getElementById("sideEntry").value);
			paddler.set("Section", document.getElementById("sectionEntry").value);
			
			paddler.save(null, {
				success: function(results) {
				
					// Changes the table to contain the new information
					var myTable = document.getElementById("paddlers");
					myTable.rows[myTable.rows.length-1].cells[0].innerHTML = document.getElementById("nameEntry").value;
					myTable.rows[myTable.rows.length-1].cells[0].id = paddler.id;
					myTable.rows[myTable.rows.length-1].cells[1].innerHTML = parseInt(document.getElementById("weightEntry").value);
					myTable.rows[myTable.rows.length-1].cells[2].innerHTML = document.getElementById("sideEntry").value;
					myTable.rows[myTable.rows.length-1].cells[3].innerHTML = document.getElementById("sectionEntry").value;
					myTable.rows[myTable.rows.length-1].cells[4].innerHTML = "<button id='" + paddler.id + "' onclick='editPaddler(this.id);'>Edit</button>  <button id='" + paddler.id + "' onclick='deletePaddler(this.id);'>Delete</button>";
					
					// Creates a new row for adding paddlers
					var row = myTable.insertRow(-1);
					var cell1 = row.insertCell(0);
					var cell2 = row.insertCell(1);
					var cell3 = row.insertCell(2);
					var cell4 = row.insertCell(3);
					var cell5 = row.insertCell(4);

					// Gives values to the new row
					cell1.innerHTML = "<input type='text' id='nameEntry' placeholder='Name'>";
					cell2.innerHTML = "<input type='text' id='weightEntry' placeholder='Weight'>";
					cell3.innerHTML = "<select id='sideEntry'><option value='Any'>Any</option><option value='Left'>Left</option><option value='Right'>Right</option></select>";
					cell4.innerHTML = "<select id='sectionEntry'><option value='Any'>Any</option><option value='Box'>Box</option><option value='Engine'>Engine</option><option value='Rocket'>Rocket</option></select>";
					cell5.innerHTML = "<button onclick='addPaddler()'>Add</button>";
				},
				error: function(results, error) {
					alert(error.message);
				}
			});
			
				
		}
    
		// TODO: Handle multiple edits at once.  Currently probably cannot do that
		function editPaddler(event) {
			var Paddler = Parse.Object.extend("Paddler");
			var query = new Parse.Query(Paddler);
			query.equalTo("objectId", event);

			query.find({
			success: function(results) {

				var myTable = document.getElementById("paddlers");
	
				var rowNumber = 0;
				while(true){
					if(myTable.rows[rowNumber].cells[0].id == results[0].id){
					
						// Changes all of the row's information into input fields
						myTable.rows[rowNumber].cells[0].innerHTML = "<input type='text' id='nameEdit' value='" + myTable.rows[rowNumber].cells[0].innerHTML + "'>";
						myTable.rows[rowNumber].cells[1].innerHTML = "<input type='text' id='weightEdit' value='" + myTable.rows[rowNumber].cells[1].innerHTML + "'>";
						
						// if else statements are used to make sure that the old value shows up in the dropdown menu
						if(myTable.rows[rowNumber].cells[2].innerHTML == "Any"){
							myTable.rows[rowNumber].cells[2].innerHTML = "<select id='sideEdit'><option selected value='Any'>Any</option><option value='Left'>Left</option><option value='Right'>Right</option></select>";
						}
						else if(myTable.rows[rowNumber].cells[2].innerHTML == "Left"){
							myTable.rows[rowNumber].cells[2].innerHTML = "<select id='sideEdit'><option value='Any'>Any</option><option selected value='Left'>Left</option><option value='Right'>Right</option></select>";
						}
						else {
							myTable.rows[rowNumber].cells[2].innerHTML = "<select id='sideEdit'><option value='Any'>Any</option><option value='Left'>Left</option><option selected value='Right'>Right</option></select>";
						}
						
						// handles dropdown menus again
						if(myTable.rows[rowNumber].cells[3].innerHTML == "Any"){
							myTable.rows[rowNumber].cells[3].innerHTML = "<select id='sectionEdit'></option><option selected value='Any'>Any</option><option value='Box'>Box</option><option value='Engine'>Engine</option><option value='Rocket'>Rocket</option></select>";
						}
						else if(myTable.rows[rowNumber].cells[3].innerHTML == "Box"){
							myTable.rows[rowNumber].cells[3].innerHTML = "<select id='sectionEdit'></option><option value='Any'>Any</option><option selected value='Box'>Box</option><option value='Engine'>Engine</option><option value='Rocket'>Rocket</option></select>";
						}
						else if(myTable.rows[rowNumber].cells[3].innerHTML == "Engine"){
							myTable.rows[rowNumber].cells[3].innerHTML = "<select id='sectionEdit'></option><option value='Any'>Any</option><option value='Box'>Box</option><option selected value='Engine'>Engine</option><option value='Rocket'>Rocket</option></select>";
						}
						else{
							myTable.rows[rowNumber].cells[3].innerHTML = "<select id='sectionEdit'></option><option value='Any'>Any</option><option value='Box'>Box</option><option value='Engine'>Engine</option><option selected value='Rocket'>Rocket</option></select>";
						}
						
						
						
						myTable.rows[rowNumber].cells[4].innerHTML = "<button id='" + results[0].id + "' onclick='updatePaddler(this.id)'>Done</button> <button id='" + results[0].id + "' onclick='undoEdit(this.id)'>Cancel</button>";
						
						
						break;
					}
					rowNumber++;
				}				
			},
			error: function(error){
				alert("Error");
			}
		});
		}
	
		function updatePaddler(event){
			var Paddler = Parse.Object.extend("Paddler");
			var query = new Parse.Query(Paddler);
			query.equalTo("objectId", event);

			query.find({
			success: function(results) {

				var myTable = document.getElementById("paddlers");
	
				var rowNumber = 0;
				
				while(true){
					if(myTable.rows[rowNumber].cells[0].id == results[0].id){

			
						// Saves all information from the edit
						results[0].set("Name", document.getElementById("nameEdit").value);
						results[0].set("Weight", parseInt(document.getElementById("weightEdit").value));
						results[0].set("Side", document.getElementById("sideEdit").value);
						results[0].set("Section", document.getElementById("sectionEdit").value);
						
						results[0].save(null, {
							success: function(results2) {
							
								// Changes the table to contain the new information
								myTable.rows[rowNumber].cells[0].innerHTML = document.getElementById("nameEdit").value;
								myTable.rows[rowNumber].cells[1].innerHTML = parseInt(document.getElementById("weightEdit").value);
								myTable.rows[rowNumber].cells[2].innerHTML = document.getElementById("sideEdit").value;
								myTable.rows[rowNumber].cells[3].innerHTML = document.getElementById("sectionEdit").value;	
								myTable.rows[rowNumber].cells[4].innerHTML = "<button id='" + results[0].id + "' onclick='editPaddler(this.id);'>Edit</button>  <button id='" + results[0].id + "' onclick='deletePaddler(this.id);'>Delete</button>";


							},
							error: function(results2, error) {
								alert(error.message);
							}
						});
						break;
					}
					rowNumber++;
				}				
			},
			error: function(error){
				alert("Error");
			}
		});
		
		}
	
		function undoEdit(event){
			var Paddler = Parse.Object.extend("Paddler");
			var query = new Parse.Query(Paddler);
			query.equalTo("objectId", event);
			
			query.find({
				success: function(results) {
					var myTable = document.getElementById("paddlers");
					
					// Adds paddlers to the table 	
					var rowNumber = 0;
					
					while(true){
						if(myTable.rows[rowNumber].cells[0].id == results[0].id){
							
							var object = results[0];
							
							myTable.rows[rowNumber].cells[0].innerHTML = object.get('Name');	
							myTable.rows[rowNumber].cells[1].innerHTML = object.get('Weight');
							myTable.rows[rowNumber].cells[2].innerHTML  = object.get('Side');
							myTable.rows[rowNumber].cells[3].innerHTML  = object.get('Section');

							// Edit and Delete buttons
							myTable.rows[rowNumber].cells[4].innerHTML = "<button id='" + object.id + "' onclick='editPaddler(this.id);'>Edit</button>  <button id='" + object.id + "' onclick='deletePaddler(this.id);'>Delete</button>";
							break;
						}
						rowNumber++;
					}		
				},
				error: function(error){
					alert("Error");
				}
			});
		}
	
		// Handles deleting a paddler from the roster when the delete button is clicked for that row
		function deletePaddler(event){
			// Allows the user to confirm the deletion of an entry
			var confirmed = confirm("Are you sure you want to delete this entry?");
			if(!confirmed){
				return;
			}
			
			
			var Paddler = Parse.Object.extend("Paddler");
			var query = new Parse.Query(Paddler);
			query.equalTo("objectId", event);

			query.find({
			success: function(results) {

				var myTable = document.getElementById("paddlers");
	
				var rowNumber = 0;
				while(true){
					if(myTable.rows[rowNumber].cells[0].id == results[0].id){
						myTable.deleteRow(rowNumber);
						break;
					}
					rowNumber++;
				}

				results[0].destroy({
					success: function(myObject) {
						//alert("Deleted");
					},
					error: function(myObject, error) {
						alert("Error!");
					}
				});
				
			},
			error: function(error){
				alert("Error");
			}
		});
		

			
		
		}
  </script>

<br>

<div id="build_button">
<form action="builder.html">
    <input type="submit" value="Build">
</form>
</div>

</body>

</html>
